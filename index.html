<!DOCTYPE html>
<html>
<head>
  <title>ChainFly Solar Quote Generator</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 2em; }
    label { display: block; margin-top: 12px; }
    input, button { margin-top: 4px; padding: 6px; width: 300px; }
    button { width: auto; }
    #result { margin-top: 20px; }
  </style>
</head>
<body>
  <h2>ChainFly Rooftop Solar Quote</h2>

  <form id="quoteForm">
    <label>Customer Name:
      <input type="text" name="customer_name" required>
    </label>
    <label>Latitude:
      <input type="number" name="latitude" step="0.0001" required>
    </label>
    <label>Longitude:
      <input type="number" name="longitude" step="0.0001" required>
    </label>
    <label>Rooftop Area (m¬≤):
      <input type="number" name="rooftop_area_m2" required>
    </label>
    <label>Monthly Bill (‚Çπ):
      <input type="number" name="monthly_bill" required>
    </label>
    <label><input type="checkbox" name="is_premium"> Use premium panels?</label>

    <button type="submit">Generate Proposal</button>
  </form>

  <div id="result"></div>

  <script>
    document.getElementById('quoteForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const form = e.target;

      const data = {
        customer_name: form.customer_name.value,
        latitude: parseFloat(form.latitude.value),
        longitude: parseFloat(form.longitude.value),
        rooftop_area_m2: parseFloat(form.rooftop_area_m2.value),
        monthly_bill: parseFloat(form.monthly_bill.value),
        is_premium: form.is_premium.checked
      };

      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = "Processing...";

      try {
        const res = await fetch('https://chainflyapi-production.up.railway.app/feasibility', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });

        if (!res.ok) throw new Error("Failed to generate proposal.");

        const result = await res.json();
        const pdfPath = result.proposal_pdf.replace("generated_pdfs/", "");

        resultDiv.innerHTML = `
          <h4>‚úÖ Proposal Generated</h4>
          <p><strong>System Size:</strong> ${result.feasibility.system_size_kw} kW</p>
          <p><strong>Monthly Savings:</strong> ‚Çπ${result.savings.monthly_savings}</p>
          <a href="https://chainflyapi-production.up.railway.app/generated_pdfs/${pdfPath}" target="_blank">
            üìÑ Download PDF Proposal
          </a>
        `;
      } catch (err) {
        resultDiv.innerHTML = `<span style="color: red;">‚ùå Error: ${err.message}</span>`;
        console.error(err);
      }
    });
  </script>
</body>
</html>
